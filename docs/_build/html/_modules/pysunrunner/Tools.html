<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>pysunrunner.Tools &mdash; pysunrunner 0.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=2709fde1"></script>
        <script src="../../_static/doctools.js?v=9a2dae69"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            pysunrunner
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide.html">Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../changelog.html">ChangeLog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">License</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">pysunrunner</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">pysunrunner.Tools</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for pysunrunner.Tools</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span><span class="p">,</span> <span class="n">UnivariateSpline</span>

<div class="viewcode-block" id="Tools">
<a class="viewcode-back" href="../../modules/tools.html#pysunrunner.Tools.Tools">[docs]</a>
<span class="k">class</span> <span class="nc">Tools</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
<span class="w">	</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		This Class has all the functions doing basic mathematical</span>
<span class="sd">		operations to the vector or scalar fields.</span>
<span class="sd">		It is called after pyPLUTO.pload object is defined.</span>
<span class="sd">	&quot;&quot;&quot;</span>
<div class="viewcode-block" id="Tools.find">
<a class="viewcode-back" href="../../modules/tools.html#pysunrunner.Tools.Tools.find">[docs]</a>
	<span class="k">def</span> <span class="nf">find</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">condition</span><span class="p">):</span>
		<span class="n">res</span><span class="p">,</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">condition</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">res</span></div>

		
<div class="viewcode-block" id="Tools.deriv">
<a class="viewcode-back" href="../../modules/tools.html#pysunrunner.Tools.Tools.deriv">[docs]</a>
	<span class="k">def</span> <span class="nf">deriv</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Y</span><span class="p">,</span><span class="n">X</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			Calculates the derivative of Y with respect to X.</span>
<span class="sd">				</span>
<span class="sd">			**Inputs:**</span>
<span class="sd">			Y : 1-D array to be differentiated.\n</span>
<span class="sd">			X : 1-D array with len(X) = len(Y).\n</span>
<span class="sd">				</span>
<span class="sd">			If X is not specified then by default X is chosen to be an equally spaced array</span>
<span class="sd">			having same number of elements as Y.</span>
<span class="sd">			**Outputs:**</span>
<span class="sd">			This returns an 1-D array having the same no. of elements as Y (or X) and</span>
<span class="sd">			contains the values of dY/dX.</span>
<span class="sd">		&quot;&quot;&quot;</span>
	
		<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">Y</span><span class="p">)</span>
		<span class="n">n2</span> <span class="o">=</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span>
		<span class="k">if</span> <span class="n">X</span><span class="o">==</span><span class="kc">None</span> <span class="p">:</span> <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
		<span class="n">Xarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="n">Yarr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;float&#39;</span><span class="p">)</span>
		<span class="n">x12</span> <span class="o">=</span> <span class="n">Xarr</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">Xarr</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>   <span class="c1">#x1 - x2</span>
		<span class="n">x01</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">Xarr</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">Xarr</span>    <span class="c1">#x0 - x1</span>
		<span class="n">x02</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">Xarr</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">Xarr</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="c1">#x0 - x2</span>
		<span class="n">DfDx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">Yarr</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x12</span> <span class="o">/</span> <span class="p">(</span><span class="n">x01</span><span class="o">*</span><span class="n">x02</span><span class="p">))</span> <span class="o">+</span> <span class="n">Yarr</span> <span class="o">*</span> <span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="n">x12</span> <span class="o">-</span> <span class="mf">1.</span><span class="o">/</span><span class="n">x01</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">roll</span><span class="p">(</span><span class="n">Yarr</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x01</span> <span class="o">/</span> <span class="p">(</span><span class="n">x02</span> <span class="o">*</span> <span class="n">x12</span><span class="p">))</span>
		<span class="c1"># Formulae for the first and last points:</span>
		
		<span class="n">DfDx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">Yarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">x01</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">x02</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x01</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x02</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">Yarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">x02</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x01</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x12</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">Yarr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">x01</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x02</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">x12</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">DfDx</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">Yarr</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">x12</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x01</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span><span class="o">*</span><span class="n">x02</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span> <span class="o">+</span> <span class="n">Yarr</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">x02</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">x01</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span><span class="o">*</span><span class="n">x12</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span> <span class="o">-</span> <span class="n">Yarr</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">x02</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span><span class="o">+</span><span class="n">x12</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span><span class="o">/</span><span class="p">(</span><span class="n">x02</span><span class="p">[</span><span class="n">n2</span><span class="p">]</span><span class="o">*</span><span class="n">x12</span><span class="p">[</span><span class="n">n2</span><span class="p">])</span>
		
		<span class="k">return</span> <span class="n">DfDx</span></div>



<div class="viewcode-block" id="Tools.Grad">
<a class="viewcode-back" href="../../modules/tools.html#pysunrunner.Tools.Tools.Grad">[docs]</a>
	<span class="k">def</span> <span class="nf">Grad</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">phi</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">dx1</span><span class="p">,</span><span class="n">dx2</span><span class="p">,</span><span class="n">polar</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; This method calculates the gradient of the 2D scalar phi.</span>
<span class="sd">			</span>
<span class="sd">			**Inputs:**</span>
<span class="sd">			</span>
<span class="sd">			phi -- 2D scalar whose gradient is to be determined.\n</span>
<span class="sd">			x1 -- The &#39;x&#39; array\n</span>
<span class="sd">			x2 -- The &#39;y&#39; array\n</span>
<span class="sd">			dx1 -- The grid spacing in &#39;x&#39; direction.\n</span>
<span class="sd">			dx2 -- The grid spacing in &#39;y&#39; direction.\n</span>
<span class="sd">			polar -- The keyword should be set to True inorder to estimate the Gradient in polar co-ordinates. By default it is set to False.</span>
<span class="sd">			</span>
<span class="sd">			**Outputs:**</span>
<span class="sd">			</span>
<span class="sd">			This routine outputs a 3D array with shape = (len(x1),len(x2),2), such that [:,:,0] element corresponds to the gradient values of phi wrt to x1 and [:,:,1] are the gradient values of phi wrt to x2.</span>
<span class="sd">			</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">shape</span>
		<span class="n">grad_phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
		<span class="n">h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">))</span>
		<span class="k">if</span> <span class="n">polar</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n2</span><span class="p">):</span>
					<span class="n">h2</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">x1</span>
							
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n1</span><span class="p">):</span>
				<span class="n">scrh1</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
				<span class="n">grad_phi</span><span class="p">[</span><span class="n">i</span><span class="p">,:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="n">scrh1</span><span class="p">,</span><span class="n">x2</span><span class="p">)</span><span class="o">/</span><span class="n">h2</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n2</span><span class="p">):</span>
				<span class="n">scrh2</span> <span class="o">=</span> <span class="n">phi</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span>
				<span class="n">grad_phi</span><span class="p">[:,</span><span class="n">j</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deriv</span><span class="p">(</span><span class="n">scrh2</span><span class="p">,</span><span class="n">x1</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">grad_phi</span></div>

			
<div class="viewcode-block" id="Tools.Div">
<a class="viewcode-back" href="../../modules/tools.html#pysunrunner.Tools.Tools.Div">[docs]</a>
	<span class="k">def</span> <span class="nf">Div</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">u1</span><span class="p">,</span><span class="n">u2</span><span class="p">,</span><span class="n">x1</span><span class="p">,</span><span class="n">x2</span><span class="p">,</span><span class="n">dx1</span><span class="p">,</span><span class="n">dx2</span><span class="p">,</span><span class="n">geometry</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			This method calculates the divergence of the 2D vector fields u1 and u2.</span>
<span class="sd">		</span>
<span class="sd">		**Inputs:**</span>
<span class="sd">		</span>
<span class="sd">		u1 -- 2D vector along x1 whose divergence is to be determined.\n</span>
<span class="sd">		u2 -- 2D vector along x2 whose divergence is to be determined.\n</span>
<span class="sd">		x1 -- The &#39;x&#39; array\n</span>
<span class="sd">		x2 -- The &#39;y&#39; array\n</span>
<span class="sd">		dx1 -- The grid spacing in &#39;x&#39; direction.\n</span>
<span class="sd">		dx2 -- The grid spacing in &#39;y&#39; direction.\n</span>
<span class="sd">		geometry -- The keyword *geometry* is by default set to &#39;cartesian&#39;. It can be set to either one of the following : *cartesian*, *cylindrical*, *spherical* or *polar*. To calculate the divergence of the vector fields, respective geometric corrections are taken into account based on the value of this keyword.</span>
<span class="sd">		</span>
<span class="sd">		**Outputs:**</span>
<span class="sd">		</span>
<span class="sd">		A 2D array with same shape as u1(or u2) having the values of divergence.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="p">(</span><span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">)</span> <span class="o">=</span> <span class="n">u1</span><span class="o">.</span><span class="n">shape</span>
		<span class="n">Divergence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">))</span>
		<span class="n">du1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">))</span>
		<span class="n">du2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">))</span>
		
		<span class="n">A1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">n1</span><span class="p">)</span>
		<span class="n">A2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="n">n2</span><span class="p">)</span>
		
		<span class="n">dV1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">))</span>
		<span class="n">dV2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">n1</span><span class="p">,</span><span class="n">n2</span><span class="p">))</span>
		
		<span class="k">if</span> <span class="n">geometry</span> <span class="o">==</span> <span class="kc">None</span> <span class="p">:</span> <span class="n">geometry</span> <span class="o">=</span> <span class="s1">&#39;cartesian&#39;</span>
		
		<span class="c1">#------------------------------------------------</span>
		<span class="c1">#  define area and volume elements for the</span>
		<span class="c1">#  different coordinate systems</span>
		<span class="c1">#------------------------------------------------</span>
		
		<span class="k">if</span> <span class="n">geometry</span> <span class="o">==</span> <span class="s1">&#39;cartesian&#39;</span> <span class="p">:</span>
			<span class="n">A1</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">1.0</span>
			<span class="n">A2</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">1.0</span>
			<span class="n">dV1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">dx1</span><span class="p">,</span><span class="n">A2</span><span class="p">)</span>
			<span class="n">dV2</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">outer</span><span class="p">(</span><span class="n">A1</span><span class="p">,</span><span class="n">dx2</span><span class="p">)</span>
		
		<span class="k">if</span> <span class="n">geometry</span> <span class="o">==</span> <span class="s1">&#39;cylindrical&#39;</span> <span class="p">:</span>
			<span class="n">A1</span> <span class="o">=</span> <span class="n">x1</span>
			<span class="n">A2</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">1.0</span>
			<span class="n">dV1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1</span><span class="o">*</span><span class="n">dx1</span><span class="p">,</span><span class="n">A2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1</span><span class="o">*</span><span class="n">dx1</span><span class="p">,</span><span class="n">A2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n1</span><span class="p">)</span> <span class="p">:</span> <span class="n">dV2</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">dx2</span><span class="p">[:]</span>
		
		<span class="k">if</span> <span class="n">geometry</span> <span class="o">==</span> <span class="s1">&#39;polar&#39;</span> <span class="p">:</span>
			<span class="n">A1</span>    <span class="o">=</span> <span class="n">x1</span>
			<span class="n">A2</span><span class="p">[:]</span> <span class="o">=</span> <span class="mf">1.0</span>
			<span class="n">dV1</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">A2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">A2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
			<span class="n">dV2</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">dx2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">dx2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>

		<span class="k">if</span> <span class="n">geometry</span> <span class="o">==</span> <span class="s1">&#39;spherical&#39;</span> <span class="p">:</span>
			<span class="n">A1</span> <span class="o">=</span> <span class="n">x1</span><span class="o">*</span><span class="n">x1</span>
			<span class="n">A2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n2</span><span class="p">):</span> <span class="n">dV1</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">A1</span><span class="o">*</span><span class="n">dx1</span>
			<span class="n">dV2</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="n">dx2</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span><span class="o">*</span><span class="n">dx2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">T</span>
		
		<span class="c1"># ------------------------------------------------</span>
		<span class="c1">#              Make divergence</span>
		<span class="c1"># ------------------------------------------------</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n1</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">du1</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">A1</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">u1</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">A1</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">u1</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">,:])</span><span class="o">/</span><span class="n">dV1</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">n2</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
			<span class="n">du2</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">A2</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">u2</span><span class="p">[:,</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">A2</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">u2</span><span class="p">[:,</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">/</span><span class="n">dV2</span><span class="p">[:,</span><span class="n">j</span><span class="p">]</span>

		<span class="n">Divergence</span> <span class="o">=</span> <span class="n">du1</span> <span class="o">+</span> <span class="n">du2</span>
		<span class="k">return</span> <span class="n">Divergence</span></div>



<div class="viewcode-block" id="Tools.RTh2Cyl">
<a class="viewcode-back" href="../../modules/tools.html#pysunrunner.Tools.Tools.RTh2Cyl">[docs]</a>
	<span class="k">def</span> <span class="nf">RTh2Cyl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">Th</span><span class="p">,</span><span class="n">X1</span><span class="p">,</span><span class="n">X2</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			This method does the transformation from spherical coordinates to cylindrical ones.</span>
<span class="sd">			**Inputs:**</span>
<span class="sd">			</span>
<span class="sd">			R - 2D array of spherical radius coordinates.\n</span>
<span class="sd">			Th - 2D array of spherical theta-angle coordinates.\n</span>
<span class="sd">			X1 - 2D array of radial component of given vector\n</span>
<span class="sd">			X2 - 2D array of thetoidal component of given vector\n</span>
<span class="sd">			</span>
<span class="sd">			**Outputs:**</span>
<span class="sd">			</span>
<span class="sd">			This routine outputs two 2D arrays after transformation.</span>
<span class="sd">			</span>
<span class="sd">			**Usage:**</span>
<span class="sd">			</span>
<span class="sd">			``import pyPLUTO as pp``\n</span>
<span class="sd">			``import numpy as np``\n</span>
<span class="sd">			``D = pp.pload(0)``\n</span>
<span class="sd">			``ppt=pp.Tools()``\n</span>
<span class="sd">			``TH,R=np.meshgrid(D.x2,D.x1)``\n</span>
<span class="sd">			``Br,Bz=ppt.RTh2Cyl(R,TH,D.bx1,D.bx2)``</span>
<span class="sd">			</span>
<span class="sd">			D.bx1 and D.bx2 should be vectors in spherical coordinates. After transformation (Br,Bz) corresponds to vector in cilindrical coordinates.</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">Y1</span><span class="o">=</span><span class="n">X1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span><span class="o">+</span><span class="n">X2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
		<span class="n">Y2</span><span class="o">=</span><span class="n">X1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span><span class="o">-</span><span class="n">X2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">Th</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">Y1</span><span class="p">,</span><span class="n">Y2</span></div>

			
			
<div class="viewcode-block" id="Tools.myInterpol">
<a class="viewcode-back" href="../../modules/tools.html#pysunrunner.Tools.Tools.myInterpol">[docs]</a>
	<span class="k">def</span> <span class="nf">myInterpol</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">RR</span><span class="p">,</span><span class="n">N</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			This method interpolates (linear interpolation) vector 1D vector RR to 1D N-length vector. Useful for stretched grid calculations.</span>
<span class="sd">			**Inputs:**</span>
<span class="sd">			RR - 1D array to interpolate.\n</span>
<span class="sd">			N  - Number of grids to interpolate to.\n</span>
<span class="sd">			**Outputs:**</span>
<span class="sd">			This routine outputs interpolated 1D array to the new grid (len=N).</span>
<span class="sd">			**Usage:**</span>
<span class="sd">			</span>
<span class="sd">			``import pyPLUTO as pp``\n</span>
<span class="sd">			``import numpy as np``\n</span>
<span class="sd">			``D = pp.pload(0)``\n</span>
<span class="sd">			``ppt=pp.Tools()``\n</span>
<span class="sd">			``x=linspace(0,1,10) #len(x)=10``\n</span>
<span class="sd">			``y=x*x``\n</span>
<span class="sd">			``Ri,Ni=ppt.myInterpol(y,100) #len(Ri)=100``</span>
<span class="sd">			</span>
<span class="sd">			Ri - interpolated numbers;</span>
<span class="sd">			Ni - grid for Ri</span>
<span class="sd">		&quot;&quot;&quot;</span>
		
		<span class="n">NN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">RR</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">RR</span><span class="p">))</span>
		<span class="n">spline_fit</span><span class="o">=</span><span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">RR</span><span class="p">,</span><span class="n">NN</span><span class="p">,</span><span class="n">k</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span><span class="n">s</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">RRi</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">RR</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">RR</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">N</span><span class="p">)</span>
		<span class="n">NNi</span><span class="o">=</span><span class="n">spline_fit</span><span class="p">(</span><span class="n">RRi</span><span class="p">)</span>
		<span class="n">NNi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="n">NN</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="mf">0.00001</span>
		<span class="n">NNi</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">NN</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="mf">0.00001</span>
		<span class="k">return</span> <span class="n">RRi</span><span class="p">,</span><span class="n">NNi</span></div>



<div class="viewcode-block" id="Tools.getUniformGrid">
<a class="viewcode-back" href="../../modules/tools.html#pysunrunner.Tools.Tools.getUniformGrid">[docs]</a>
	<span class="k">def</span> <span class="nf">getUniformGrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">rho</span><span class="p">,</span><span class="n">Nr</span><span class="p">,</span><span class="n">Nth</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot; This method transforms data with non-uniform grid (stretched) to uniform. Useful for stretched grid calculations.</span>

<span class="sd">			**Inputs:**</span>
<span class="sd">			r  - 1D vector of X1 coordinate (could be any, e.g D.x1).\n</span>
<span class="sd">			th - 1D vector of X2 coordinate (could be any, e.g D.x2).\n</span>
<span class="sd">			rho- 2D array of data.\n</span>
<span class="sd">			Nr - new size of X1 vector.\n</span>
<span class="sd">			Nth- new size of X2 vector.\n</span>
<span class="sd">			</span>
<span class="sd">			**Outputs:**</span>
<span class="sd">			</span>
<span class="sd">			This routine outputs 2D uniform array Nr x Nth dimension</span>
<span class="sd">			</span>
<span class="sd">			**Usage:**</span>
<span class="sd">			</span>
<span class="sd">			``import pyPLUTO as pp``\n</span>
<span class="sd">			``import numpy as np``\n</span>
<span class="sd">			``D = pp.pload(0)``\n</span>
<span class="sd">			``ppt=pp.Tools()``\n</span>
<span class="sd">			``X1new, X2new, res = ppt.getUniformGrid(D.x1,D.x2,D.rho,20,30)``</span>
<span class="sd">			</span>
<span class="sd">			X1new - X1 interpolated grid len(X1new)=20</span>
<span class="sd">			X2new - X2 interpolated grid len(X2new)=30</span>
<span class="sd">			res   - 2D array of interpolated variable</span>
<span class="sd">			</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="n">Ri</span><span class="p">,</span><span class="n">NRi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">myInterpol</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">Nr</span><span class="p">)</span>
		<span class="n">Ra</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">NRi</span><span class="p">);</span><span class="n">Wr</span><span class="o">=</span><span class="n">NRi</span><span class="o">-</span><span class="n">Ra</span>
			
		<span class="n">YY</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">Nr</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)])</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)):</span>
			<span class="n">YY</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Wr</span><span class="p">)</span><span class="o">*</span><span class="n">rho</span><span class="p">[</span><span class="n">Ra</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">Wr</span><span class="o">*</span><span class="n">rho</span><span class="p">[</span><span class="n">Ra</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
					
		<span class="n">THi</span><span class="p">,</span><span class="n">NTHi</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">myInterpol</span><span class="p">(</span><span class="n">th</span><span class="p">,</span><span class="n">Nth</span><span class="p">)</span>
		<span class="n">THa</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">NTHi</span><span class="p">);</span><span class="n">Wth</span><span class="o">=</span><span class="n">NTHi</span><span class="o">-</span><span class="n">THa</span>
		<span class="n">ZZ</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">([</span><span class="n">Nr</span><span class="p">,</span><span class="n">Nth</span><span class="p">])</span>
		<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">Nr</span><span class="p">):</span>
			<span class="n">ZZ</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">Wth</span><span class="p">)</span><span class="o">*</span><span class="n">YY</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">THa</span><span class="p">]</span> <span class="o">+</span> <span class="n">Wth</span><span class="o">*</span><span class="n">YY</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">THa</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">return</span> <span class="n">Ri</span><span class="p">,</span><span class="n">THi</span><span class="p">,</span><span class="n">ZZ</span></div>

			
<div class="viewcode-block" id="Tools.congrid">
<a class="viewcode-back" href="../../modules/tools.html#pysunrunner.Tools.Tools.congrid">[docs]</a>
	<span class="k">def</span> <span class="nf">congrid</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">newdims</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">centre</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">minusone</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		Arbitrary resampling of source array to new dimension sizes.</span>
<span class="sd">		Currently only supports maintaining the same number of dimensions.</span>
<span class="sd">		To use 1-D arrays, first promote them to shape (x,1).</span>
<span class="sd">		</span>
<span class="sd">		Uses the same parameters and creates the same co-ordinate lookup points</span>
<span class="sd">		as IDL&#39;&#39;s congrid routine, which apparently originally came from a VAX/VMS</span>
<span class="sd">		routine of the same name.</span>
<span class="sd">		</span>
<span class="sd">		**Inputs:**</span>
<span class="sd">		</span>
<span class="sd">		a -- The 2D array that needs resampling into new dimensions.\n</span>
<span class="sd">		newdims -- A tuple which represents the shape of the resampled data\n</span>
<span class="sd">		method -- This keyword decides the method used for interpolation.\n</span>
<span class="sd">		neighbour - closest value from original data\n</span>
<span class="sd">		nearest and linear - uses n x 1-D interpolations using scipy.interpolate.interp1d</span>
<span class="sd">		(see Numerical Recipes for validity of use of n 1-D interpolations)\n</span>
<span class="sd">		spline - uses ndimage.map_coordinates\n</span>
<span class="sd">		centre -- This keyword decides the positions of interpolation points.\n</span>
<span class="sd">		True - interpolation points are at the centres of the bins\n</span>
<span class="sd">		False - points are at the front edge of the bin\n</span>
<span class="sd">		minusone -- This prevents extrapolation one element beyond bounds of input array\n</span>
<span class="sd">		For example- inarray.shape = (i,j) &amp; new dimensions = (x,y)\n</span>
<span class="sd">		False - inarray is resampled by factors of (i/x) * (j/y)\n</span>
<span class="sd">		True - inarray is resampled by(i-1)/(x-1) * (j-1)/(y-1)\n</span>
<span class="sd">		</span>
<span class="sd">		**Outputs:**</span>
<span class="sd">		</span>
<span class="sd">		A 2D array with resampled data having a shape corresponding to newdims.</span>
<span class="sd">	</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">dtype</span> <span class="ow">in</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">]:</span>
			<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cast</span><span class="p">[</span><span class="nb">float</span><span class="p">](</span><span class="n">a</span><span class="p">)</span>
		<span class="n">m1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cast</span><span class="p">[</span><span class="nb">int</span><span class="p">](</span><span class="n">minusone</span><span class="p">)</span>
		<span class="n">ofs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cast</span><span class="p">[</span><span class="nb">int</span><span class="p">](</span><span class="n">centre</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.5</span>
		<span class="n">old</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span> <span class="p">)</span>
		<span class="n">ndims</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span> <span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">newdims</span> <span class="p">)</span> <span class="o">!=</span> <span class="n">ndims</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;[congrid] dimensions error. This routine currently only support rebinning to the same number of dimensions.&quot;</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">None</span>
		<span class="n">newdims</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span> <span class="n">newdims</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span> <span class="p">)</span>
		<span class="n">dimlist</span> <span class="o">=</span> <span class="p">[]</span>
		
		<span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;neighbour&#39;</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">ndims</span> <span class="p">):</span>
					<span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">newdims</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span>
					<span class="n">dimlist</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">old</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">newdims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ofs</span><span class="p">)</span><span class="o">-</span><span class="n">ofs</span><span class="p">)</span>
			<span class="n">cd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="n">dimlist</span> <span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
			<span class="n">newa</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span> <span class="n">cd</span> <span class="p">)]</span>
			<span class="k">return</span> <span class="n">newa</span>
		
		<span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span><span class="s1">&#39;linear&#39;</span><span class="p">]:</span>
				<span class="c1"># calculate new dims</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">ndims</span> <span class="p">):</span>
					<span class="n">base</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span> <span class="n">newdims</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
					<span class="n">dimlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span><span class="n">old</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">newdims</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">base</span> <span class="o">+</span> <span class="n">ofs</span><span class="p">)</span> <span class="o">-</span> <span class="n">ofs</span> <span class="p">)</span>
			<span class="c1"># specify old dims</span>
			<span class="n">olddims</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">dtype</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">float</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span> <span class="n">a</span><span class="o">.</span><span class="n">shape</span> <span class="p">)]</span>
			
			<span class="c1"># first interpolation - for ndims = any</span>
			<span class="n">mint</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span> <span class="n">olddims</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">a</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">method</span> <span class="p">)</span>
			<span class="n">newa</span> <span class="o">=</span> <span class="n">mint</span><span class="p">(</span> <span class="n">dimlist</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
			<span class="n">trorder</span> <span class="o">=</span> <span class="p">[</span><span class="n">ndims</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span> <span class="n">ndims</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">))</span>
			<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span> <span class="n">ndims</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span> <span class="p">):</span>
					<span class="n">newa</span> <span class="o">=</span> <span class="n">newa</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">trorder</span> <span class="p">)</span>
					<span class="n">mint</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span> <span class="n">olddims</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">newa</span><span class="p">,</span> <span class="n">kind</span><span class="o">=</span><span class="n">method</span> <span class="p">)</span>
					<span class="n">newa</span> <span class="o">=</span> <span class="n">mint</span><span class="p">(</span> <span class="n">dimlist</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
			
			<span class="k">if</span> <span class="n">ndims</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="c1"># need one more transpose to return to original dimensions</span>
				<span class="n">newa</span> <span class="o">=</span> <span class="n">newa</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span> <span class="n">trorder</span> <span class="p">)</span>
			<span class="k">return</span> <span class="n">newa</span>
		
		<span class="k">elif</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;spline&#39;</span><span class="p">]:</span>
			<span class="n">oslices</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">old</span> <span class="p">]</span>
			<span class="n">oldcoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ogrid</span><span class="p">[</span><span class="n">oslices</span><span class="p">]</span>
			<span class="n">nslices</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">newdims</span><span class="p">)</span> <span class="p">]</span>
			<span class="n">newcoords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mgrid</span><span class="p">[</span><span class="n">nslices</span><span class="p">]</span>
			<span class="n">newcoords_dims</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">rank</span><span class="p">(</span><span class="n">newcoords</span><span class="p">))</span>
			<span class="c1">#make first index last</span>
			<span class="n">newcoords_dims</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">newcoords_dims</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
			<span class="n">newcoords_tr</span> <span class="o">=</span> <span class="n">newcoords</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">newcoords_dims</span><span class="p">)</span>
			<span class="c1"># makes a view that affects newcoords</span>
			<span class="n">newcoords_tr</span> <span class="o">+=</span> <span class="n">ofs</span>
			<span class="n">deltas</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">old</span><span class="p">)</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">newdims</span> <span class="o">-</span> <span class="n">m1</span><span class="p">)</span>
			<span class="n">newcoords_tr</span> <span class="o">*=</span> <span class="n">deltas</span>
			<span class="n">newcoords_tr</span> <span class="o">-=</span> <span class="n">ofs</span>
			<span class="n">newa</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">ndimage</span><span class="o">.</span><span class="n">map_coordinates</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">newcoords</span><span class="p">)</span>
			<span class="k">return</span> <span class="n">newa</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Congrid error: Unrecognized interpolation type. Currently only </span><span class="se">\&#39;</span><span class="s2">neighbour</span><span class="se">\&#39;</span><span class="s2">, </span><span class="se">\&#39;</span><span class="s2">nearest</span><span class="se">\&#39;</span><span class="s2">,</span><span class="se">\&#39;</span><span class="s2">linear</span><span class="se">\&#39;</span><span class="s2"> and </span><span class="se">\&#39;</span><span class="s2">spline</span><span class="se">\&#39;</span><span class="s2"> are supported.&quot;</span><span class="p">)</span>
			<span class="k">return</span> <span class="kc">None</span></div>



<div class="viewcode-block" id="Tools.sph2cyl">
<a class="viewcode-back" href="../../modules/tools.html#pysunrunner.Tools.Tools.sph2cyl">[docs]</a>
	<span class="k">def</span> <span class="nf">sph2cyl</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">D</span><span class="p">,</span><span class="n">Dx</span><span class="p">,</span><span class="n">rphi</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">theta0</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">		</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">			This method transforms spherical data into cylindrical applying interpolation.</span>
<span class="sd">			Works for stretched grid as well, transforms poloidal (R-Theta) data by default.</span>
<span class="sd">			Fix theta and set rphi=True to get (R-Phi) transformation.</span>
<span class="sd">			</span>
<span class="sd">			**Inputs:**</span>
<span class="sd">			</span>
<span class="sd">			D  - structure  from &#39;pload&#39; method.\n</span>
<span class="sd">			Dx - variable to be transformed (D.rho for example).\n</span>
<span class="sd">			</span>
<span class="sd">			**Outputs:**</span>
<span class="sd">			</span>
<span class="sd">			This routine outputs transformed (sph-&gt;cyl) variable and grid.</span>
<span class="sd">			</span>
<span class="sd">			**Usage:**</span>
<span class="sd">			</span>
<span class="sd">			``import pyPLUTO as pp``\n</span>
<span class="sd">			``import numpy as np``\n</span>
<span class="sd">			``D = pp.pload(0)``\n</span>
<span class="sd">			``ppt=pp.Tools()``\n</span>
<span class="sd">			``R,Z,res = ppt.sph2cyl(D,D.rho.transpose())``</span>
<span class="sd">			</span>
<span class="sd">			R - 2D array with cylindrical radius values</span>
<span class="sd">			Z - 2D array with cylindrical Z values</span>
<span class="sd">			res - 2D array of transformed variable</span>
<span class="sd">			</span>
<span class="sd">		&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">rphi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rphi</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
			<span class="n">rx</span><span class="o">=</span><span class="n">D</span><span class="o">.</span><span class="n">x1</span>
			<span class="n">th</span><span class="o">=</span><span class="n">D</span><span class="o">.</span><span class="n">x2</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">rx</span><span class="o">=</span><span class="n">D</span><span class="o">.</span><span class="n">x1</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta0</span><span class="p">)</span>
			<span class="n">th</span><span class="o">=</span><span class="n">D</span><span class="o">.</span><span class="n">x3</span>

		<span class="n">rx</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">Dx</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">getUniformGrid</span><span class="p">(</span><span class="n">rx</span><span class="p">,</span><span class="n">th</span><span class="p">,</span><span class="n">Dx</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span>
		<span class="n">Dx</span><span class="o">=</span><span class="n">Dx</span><span class="o">.</span><span class="n">T</span>

		<span class="k">if</span> <span class="n">rphi</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">rphi</span> <span class="o">==</span> <span class="kc">False</span><span class="p">:</span>
			<span class="n">r0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="o">*</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
			<span class="n">rN</span><span class="o">=</span><span class="n">rx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">r0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="o">*</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="o">*</span><span class="n">rx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>
			<span class="n">rN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="o">*</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="o">*</span><span class="n">rx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

		<span class="n">dr</span><span class="o">=</span><span class="n">rN</span><span class="o">-</span><span class="n">r0</span>
		<span class="n">z0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="o">*</span><span class="n">rN</span><span class="p">)</span>
		<span class="n">zN</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">th</span><span class="p">)</span><span class="o">*</span><span class="n">rN</span><span class="p">)</span>
		<span class="n">dz</span><span class="o">=</span><span class="n">zN</span><span class="o">-</span><span class="n">z0</span>
		<span class="n">dth</span><span class="o">=</span><span class="n">th</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">rl</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span><span class="o">*</span><span class="n">dr</span><span class="o">/</span><span class="p">(</span><span class="n">rx</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
		<span class="n">zl</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">rl</span><span class="o">*</span> <span class="n">dz</span><span class="o">/</span><span class="n">dr</span><span class="p">)</span>
		<span class="n">thl</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">th</span><span class="p">)</span>
		<span class="n">r</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">r0</span><span class="p">,</span> <span class="n">rN</span><span class="p">,</span> <span class="n">rl</span><span class="p">)</span>
		<span class="n">z</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">z0</span><span class="p">,</span> <span class="n">zN</span><span class="p">,</span> <span class="n">zl</span><span class="p">)</span>
																		
		<span class="n">R</span><span class="p">,</span><span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">z</span><span class="p">)</span>
		<span class="n">Rs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">R</span><span class="o">*</span><span class="n">R</span> <span class="o">+</span> <span class="n">Z</span><span class="o">*</span><span class="n">Z</span><span class="p">)</span>
		
		<span class="n">Th</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">Z</span><span class="o">/</span><span class="n">Rs</span><span class="p">)</span>
		<span class="n">kv_34</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">R</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
		<span class="n">Th</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">kv_34</span><span class="p">]</span><span class="o">=</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">-</span> <span class="n">Th</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">kv_34</span><span class="p">]</span>
		<span class="n">ddr</span><span class="o">=</span><span class="n">rx</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">ddth</span><span class="o">=</span><span class="n">th</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

		<span class="n">Rs_copy</span><span class="o">=</span><span class="n">Rs</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">Th_copy</span><span class="o">=</span><span class="n">Th</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

		<span class="n">nR1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Rs</span><span class="o">&lt;</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">Rs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">nR1</span><span class="p">]</span><span class="o">=</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
		<span class="n">nR2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Rs</span><span class="o">&gt;</span><span class="n">rN</span><span class="p">)</span>
		<span class="n">Rs</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">nR2</span><span class="p">]</span><span class="o">=</span><span class="n">rN</span>

		<span class="n">nTh1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Th</span><span class="o">&gt;</span><span class="n">th</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
		<span class="n">Th</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">nTh1</span><span class="p">]</span><span class="o">=</span><span class="n">th</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
		<span class="n">nTh2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Th</span><span class="o">&lt;</span><span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
		<span class="n">Th</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">nTh2</span><span class="p">]</span><span class="o">=</span><span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>


		<span class="n">ra</span> <span class="o">=</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span><span class="o">-</span><span class="mf">1.001</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">Rs</span><span class="o">.</span><span class="n">flat</span><span class="p">)</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Rs</span><span class="o">.</span><span class="n">flat</span><span class="p">))</span> <span class="o">*</span><span class="p">(</span><span class="n">Rs</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">Rs</span><span class="o">.</span><span class="n">flat</span><span class="p">)))</span>
		<span class="n">tha</span> <span class="o">=</span> <span class="p">((</span><span class="n">thl</span><span class="o">-</span><span class="mf">1.001</span><span class="p">)</span><span class="o">/</span><span class="n">dth</span> <span class="o">*</span><span class="p">(</span><span class="n">Th</span><span class="o">-</span><span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

		<span class="n">rn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">ra</span><span class="p">)</span>
		<span class="n">thn</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">tha</span><span class="p">)</span>
		<span class="n">dra</span><span class="o">=</span><span class="n">ra</span><span class="o">-</span><span class="n">rn</span>
		<span class="n">dtha</span><span class="o">=</span><span class="n">tha</span><span class="o">-</span><span class="n">thn</span>
		<span class="n">w1</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">dra</span>
		<span class="n">w2</span><span class="o">=</span><span class="n">dra</span>
		<span class="n">w3</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="n">dtha</span>
		<span class="n">w4</span><span class="o">=</span><span class="n">dtha</span>
		<span class="n">lrx</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">rx</span><span class="p">)</span>
		<span class="n">NN1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">rn</span><span class="o">+</span><span class="n">thn</span><span class="o">*</span><span class="n">lrx</span><span class="p">)</span>
		<span class="n">NN2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">((</span><span class="n">rn</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="n">thn</span><span class="o">*</span><span class="n">lrx</span><span class="p">)</span>
		<span class="n">NN3</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">(</span><span class="n">rn</span><span class="o">+</span><span class="p">(</span><span class="n">thn</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">lrx</span><span class="p">)</span>
		<span class="n">NN4</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">((</span><span class="n">rn</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="p">(</span><span class="n">thn</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">lrx</span><span class="p">)</span>
		<span class="n">n</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">R</span><span class="p">))))</span>
		<span class="n">DD</span><span class="o">=</span><span class="n">Dx</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">F</span><span class="o">=</span><span class="n">R</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
		<span class="n">F</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">=</span><span class="n">w1</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">w3</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="n">Dx</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">NN1</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="o">+</span> <span class="n">w4</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="n">Dx</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">NN3</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="p">)</span><span class="o">+</span>\
			<span class="n">w2</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">w3</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="n">Dx</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">NN2</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="o">+</span> <span class="n">w4</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="n">Dx</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">NN4</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">n</span><span class="p">]]</span> <span class="p">)</span>
				
		<span class="n">nR1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Rs_copy</span><span class="o">&lt;</span><span class="n">rx</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ddr</span><span class="o">/</span><span class="mf">1.5</span><span class="p">)</span>
		<span class="n">nR2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Rs_copy</span><span class="o">&gt;</span><span class="n">rN</span><span class="o">+</span><span class="n">ddr</span><span class="o">/</span><span class="mf">1.5</span><span class="p">)</span>
		<span class="n">nTh1</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Th_copy</span><span class="o">&gt;</span><span class="n">th</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">ddth</span><span class="o">/</span><span class="mf">1.5</span><span class="p">)</span>
		<span class="n">nTh2</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">Th_copy</span><span class="o">&lt;</span><span class="n">th</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">-</span><span class="n">ddth</span><span class="o">/</span><span class="mf">1.5</span><span class="p">)</span>
			
		<span class="n">nmask</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">nR1</span><span class="p">,</span><span class="n">nR2</span><span class="p">,</span><span class="n">nTh1</span><span class="p">,</span><span class="n">nTh2</span><span class="p">))</span>
		<span class="n">F</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="n">nmask</span><span class="p">]</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">;</span>
		<span class="k">return</span> <span class="n">R</span><span class="p">,</span><span class="n">Z</span><span class="p">,</span><span class="n">F</span></div>
</div>





</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Predictive Science Inc..</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>